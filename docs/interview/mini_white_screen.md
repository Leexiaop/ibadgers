---
title: 微信小程序解决白屏问题
group: 小程序
toc: content
---

下程序在冷启动运行的时候，我们经常会遇到，小程序长时间的白屏。带来了比较差的用户
体验，那么我们如何解决这样的问题呢？

## 为什么会出现长时间白屏

小程序在首次启动前，微信会在小程序启动前为小程序准备好通用的运行环境。如运行中的
线程和一些基础库的初始化，然后才开始进入启动状态，展示一个固定的启动界面，界面内
包含了小程序的图标，名称和加载提示等，此时，微信会在背后完成几项工作：

- 下载小程序代码包
- 加载小程序的代码包
- 初始化小程序的首页

这就是比较耗费时间的过程。

## 如何解决

关于上面的问题，我们可以从俩个方面切入，即加载和渲染俩个方面。

### 加载

提升体验最直接的方法是控制小程序包的大小，常见手段有如下：

- 代码包的体积压缩可以通过勾选开发者工具中“上传代码时，压缩代码”选项
- 及时清理无用的代码和资源文件
- 减少资源包中的图片等资源的数量和大小（理论上除了小 icon，其他图片资源从网络
  下载），图片资源压缩率有限。并且可以采取分包加载的操作，将用户访问率高的页面
  放在主包里，将访问率低的页面放入子包里，按需加载。当用户点击到子包的目录时，
  还是有一个代码包下载的过程，这会感觉到明显的卡顿，所以子包也不建议拆的太大，
  当然我们可以采用子包预加载技术，并不需要等到用户点击到子包页面后在下载子包。

### 渲染

关于微信小程序首屏渲染优化的手段如下：

- 请求可以在页面 onLoad 就加载，不需要等页面 ready 后在异步请求数据
- 尽量减少不必要的 https 请求，可使用 getStorageSync() 及 setStorageSync() 方
  法将数据存储在本地
- 可以在前置页面将一些有用的字段带到当前页，进行首次渲染（列表页的某些数据-->
  详情页），没有数据的模块可以进行骨架屏的占位

在微信小程序中，提高页面的多次渲染效率主要在于正确使用 setData：

- 不要过于频繁调用 setData，应考虑将多次 setData 合并成一次 setData 调用
- 数据通信的性能与数据量正相关，因而如果有一些数据字段不在界面中展示且数据结构
  比较复杂或包含长字符串，则不应使用 setData 来设置这些数据
- 与界面渲染无关的数据最好不要设置在 data 中，可以考虑设置在 page 对象的其他字
  段下除此之外，对于一些独立的模块我们尽可能抽离出来，这是因为自定义组件的更新
  并不会影响页面上其他元素的更新

各个组件也将具有各自独立的逻辑空间。每个组件都分别拥有自己的独立的数据、setData
调用

## 总结

小程序启动加载性能：

- 控制代码包的大小
- 分包加载
- 首屏体验（预请求，利用缓存，避免白屏，及时反馈小程序渲染性能：
- 避免不当的使用 setData
- 使用自定义组件
